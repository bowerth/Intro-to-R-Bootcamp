---
title: "R Programming"
subtitle: "Get me some data!"
author: | 
  | Bo Werth, FAO
output: 
  ioslides_presentation:
    logo: ../images/oecd_logo2.png
    widescreen: true
    smaller: true
    transition: 0.01
---


# Key Things to Know

## What to Remember from this Section
<br><br>

1. Lots of built-in data sets provided by R
2. Text files use delimiters - these determine the function to read in the data
3. There is no base R function to read in Excel data - must use a package
4. Web scraping is a dense subject but scraping online text/Excel files *can* be as easy as reading in these files from your hard drive


# Built-in Data

## Built-in Data Sets

- R has many built-in data sets
- type `data()` into your console (104 data sets should appear)

```{r}
mtcars
```

## Built in Data Sets

- R also has many convenient built-in character strings to be aware of
- Try these:

```{r, cache=TRUE, collapse=TRUE, eval=FALSE}
letters
LETTERS
month.abb
month.name
state.abb
state.division
state.name
state.region
```

<br>

### Note

- to load any of these data sets/strings into your global environment: `data("name of data set")`
- type `?name` to get more information about the built-in data


## Your Turn

<br>
<br>

<font size="10">
`1.` Load the `iris` data set

<br>

`2.` What is this data measuring?
</font>



## Solution
<br>
<br>

`1.` Load the `iris` data set
```{r, collapse=TRUE, eval=FALSE}
data(iris)
```

<br>

`2.` What is this data measuring?
```{r, collapse=TRUE, eval=FALSE}
?iris
```

Description from the help screen: "This famous (Fisher's or Anderson's) iris data set gives the measurements in centimeters of the variables sepal length and width and petal length and width, respectively, for 50 flowers from each of 3 species of iris. The species are Iris setosa, versicolor, and virginica."

# Importing Text Files

## Importing Text Files | .csv .txt .tsv

- Text files are a popular way to hold and exchange tabular data
- Text file formats use **delimiters** to separate the different elements
    - .csv
    - .txt
    - .tsv
- These delimiters help us know what functions to use to read in the data
- I'll illustrate with the following files in the R-Bootcamp download file
    - `mydata.csv`
    - `mydata.txt`
    - `mydata.tsv`

## Importing Text Files | Base R

Use `read.csv` for comma separated files (automatically sets the `sep = ","`)
```{r, cache=TRUE, collapse=TRUE, warning=FALSE}
read.csv("../data/mydata.csv")
```
<br>

Use `read.delim` for tab delimited files (automatically sets the `sep = "\t"`)
```{r, cache=TRUE, collapse=TRUE, warning=FALSE}
read.delim("../data/mydata.txt")
```

## Importing Text Files | Base R

When importing data, save to a file by using the assignment operator:

```{r, cache=TRUE, collapse=TRUE, warning=FALSE}
mydata <- read.delim("../data/mydata.tsv")

mydata
```

<br>

- You now have a data object in your global environment named `mydata`
- View your data in a spreadsheet form:
    - clicking on the object in the global environment space or 
    - type `View(mydata)` in your console


## Your Turn
<br>
<br>

<font size="10">
`1.` Read in the `facebook.tsv` file
</font>

<br>

<font size="10">
`2.` Save it as an object titled `facebook`
</font>

<br>

<font size="10">
`3.` Take a peek at what this data looks like
</font>



## Solution

<br>
<br>

`1` & `2`: Read in the `facebook.tsv` file and save as `facebook` 
```{r, collapse=TRUE, cache=TRUE}
facebook <- read.delim("../data/facebook.tsv")
```

<br>

`3.`: Take a peek at what this data looks like
```{r, collapse=TRUE, cache=TRUE, eval=FALSE}
View(facebook)
```


# Importing Excel Files

## Importing Excel Files

- Excel is still the spreadsheet software of choice
- Base R does not have an Excel importing function but we can use the [`readxl`](https://cran.rstudio.com/web/packages/readxl/) package

```{r, collapse=TRUE, cache=TRUE, warning=FALSE}
# if you haven't installed the readxl package run the following line (minus hashtag)
# install.packages("readxl")

library(readxl)

read_excel("../data/mydata.xlsx", sheet = "Sheet5")
```

- Benefits of `readxl`
    - recognizes date and time variables
    - keeps text variables as characters rather than factors (more to come on this)
    - does not collapse variable names
    - read more about `readxl` capabilities [here]()
- `xlsx` is an alternative package for reading in Excel files

## Your Turn
<br>

<font size="7">`1.` Read in the spreadsheet titled</font><br><br>
<font size="6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`3. Median HH income, metro` in the 
`PEW Middle` <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`Class Data.xlsx` file</font><br><br><br>
<font size="7">`2.` Save it as an object titled `pew`</font><br><br><br>
<font size="7">`3.` Take a peek at what this data looks like</font>

<br>
<br>

**Hint:** You will need to skip 5 lines &#9755; check out the help file on `read_excel` to do this

## Solution
<br>
<br>

`1` & `2`: Read in the `.xlsx` file and save as `pew` 
```{r, collapse=TRUE, cache=TRUE, warning=FALSE}
pew <- read_excel("../data/PEW Middle Class Data.xlsx", sheet = "3. Median HH income, metro", skip = 5)
```

<br>

`3`: Take a peek at what this data looks like
```{r, collapse=TRUE, cache=TRUE, eval=FALSE}
View(pew)
```


# Importing SAS and Stata files

## Importing SAS Files

- The SAS System uses a prorpietary binary format for data files (`.sas7bdat` and ` .sas7bcat`)
- The [`haven`](http://github.com/tidyverse/haven) package leverages the
  [ReadStat](https://github.com/WizardMac/ReadStat) C library to read both file
  formats and write `.sas7bdat`

```{r, collapse=TRUE, cache=TRUE, warning=FALSE}
library(haven)

helpfromSAS <- read_sas("../data/help.sas7bdat")
str(helpfromSAS[, 1:2])
```

- Benefits of `haven`
    - date times are converted to corresponding R classes
    - labelled vectors are returned as a new labelled class
    - can easily coerce to factors or replace labelled values with missings
    - all functions return tibbles
    - read more about the C library [here](https://github.com/WizardMac/ReadStat)

## Importing Stata Files

- `haven`/`ReadStat` can read Stata files up to version 14 (latest) and save objets as `.dta`
- Stata missing values are displayed as `NaN`

```{r, collapse=TRUE, cache=TRUE, warning=FALSE}
carsdataSTATA <- read_dta("../data/carsdata.dta")
psych::describe(carsdataSTATA, skew = FALSE)

carsdataSTATA$cars[1] <- NA
write_dta(carsdataSTATA, path = "../data/carsdata_out.dta", version = 14)

read_dta("../data/carsdata_out.dta")[1:3,]
```

- Supports Stata "extended" missing values, `.A` through `.Z` using a tagged `NA` in R
- See [semantics](https://github.com/tidyverse/haven/blob/master/vignettes/semantics.Rmd) vignette of `haven` package for additional information

# Scraping Online Files

## Scraping Online Files | Tabular files

- Dense subject with *LOTS* to learn
- We'll only focus on reading in tabular and Excel files stored online
<!-- - For more info regarding "real web scraping" see the tutorial at: [boot.rdata.work/scraping](boot.rdata.work/scraping) -->

<br>

Let's download some data from [https://www.data.gov/metrics](https://www.data.gov/metrics):

```{r, collapse=TRUE, cache=TRUE, eval=FALSE}
# the url for the online CSV
url <- "https://www.data.gov/media/federal-agency-participation.csv" 

# use read.csv to import
data_gov <- read.csv(url, stringsAsFactors = FALSE)

View(data_gov)
```

## Scraping Online Files | Excel files

- Scraping online Excel files follows a similar process
- `gdata` package is particular easy to use

<br>

Let's download some data from [Fair Market Rents for Section 8 Housing](http://catalog.data.gov/dataset/fair-market-rents-for-the-section-8-housing-assistance-payments-program/resource/2d33555e-5d21-4baf-84a2-e4fb3aed0807):

```{r, collapse=TRUE, cache=TRUE, eval=FALSE}
library(gdata)

url <- "http://www.huduser.org/portal/datasets/fmr/fmr2015f/FY2015F_4050_Final.xls"

# use read.xls to import
rents <- read.xls(url)

View(data_gov)
```

## Your Turn
<br>
<br>

<font size="7">
`1.` Download the file stored at:<br>
</font>

<font size="5">
`https://dl.dropboxusercontent.com/u/1807228/reddit.csv?dl=1`
</font>

<br>

<font size="7">
`2.` Save it as an object titled `reddit`
</font>

<br>

<font size="7">
`3.` Take a peek at what this data looks like
</font>

## Solution
<br>
<br>

`1.` Download the file stored at: https://dl.dropboxusercontent.com/u/1807228/reddit.csv?dl=1

`2.` Save it as an object titled `reddit`
```{r, collapse=TRUE, cache=TRUE, eval=FALSE}
url <- "https://dl.dropboxusercontent.com/u/1807228/reddit.csv?dl=1"

reddit <- read.csv(url)
```

<br>

`3.` Take a peek at what this data looks like
```{r, collapse=TRUE, cache=TRUE, eval=FALSE}
View(reddit)
```

# Key Things to Remember

## Remember These Functions!

Operator/Function       Description
-----------------       ----------------
`data()`                access built-in data sets
`?`                     will provide you information regarding built-in data (i.e. `?mtcars`)
`read.csv()`            base R function for reading in .csv files (can also be used to read in a .csv file stored online)
`read.delim()`          base R function for reading in .txt and .tsv files
`read_excel()`          imports Excel data (provided by the `readxl` package)
`read.xls()`            imports Excel data stored online (provided by the `gdata` package)
`read_sas()`              imports `.sas7bdat` and `.sas7bcat` files (provided by the `haven` package)
`read_dta()`            imports Stata files (provided by the `haven` package)
`View()`                opens a spreadsheet-style data viewer
-----------------       ----------------

- [R Data Import/Export](https://cran.r-project.org/doc/manuals/r-devel/R-data.html) manual

## Break {.flexbox .vcenter}

<div class="centered">

<font size="10">5 minutes!</font>

</div>




